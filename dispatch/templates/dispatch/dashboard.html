{% extends "base_dashboard.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
    <div class="max-w-6xl mx-auto mt-8 p-6 bg-white rounded-lg shadow">
        <h2 class="text-2xl font-semibold">Dispatch Dashboard</h2>
        <p class="mt-2 text-gray-700">Welcome, {{ request.user.username }}!</p>

        <h3 class="text-xl font-semibold mt-6">Tasks</h3>
        <table class="w-full mt-4 border border-gray-300 rounded-lg overflow-hidden">
            <thead>
            <tr class="bg-gray-200 text-gray-600 text-sm uppercase">
                <th class="px-4 py-3">Name</th>
                <th class="px-4 py-3">Category</th>
                <th class="px-4 py-3">Workers</th>
                <th class="px-4 py-3">Status</th>
                <th class="px-4 py-3">Deadline</th>
            </tr>
            </thead>
            <tbody>
            {% for task in tasks %}
                <tr class="border-t hover:bg-gray-100">
                    <td class="px-4 py-3">{{ task.name }}</td>
                    <td class="px-4 py-3">{{ task.category.name|default:"No Category" }}</td>
                    <td class="px-4 py-3">{{ task.workers.count }}</td>
                    <td class="px-4 py-3">
                        <span class="px-3 py-1 rounded-full text-sm
                            {% if task.status.name == 'Active' %} bg-green-200 text-green-700
                            {% else %} bg-yellow-200 text-yellow-700
                            {% endif %}">
                            {{ task.status.name|default:"No Status" }}
                        </span>
                    </td>
                    <td class="px-4 py-3">{{ task.deadline|default:"N/A" }}</td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="5" class="text-center py-4">No tasks available.</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

        <h3 class="text-xl font-semibold mt-6">Workers</h3>
        <table class="w-full mt-4 border border-gray-300 rounded-lg overflow-hidden">
            <thead>
            <tr class="bg-gray-200 text-gray-600 text-sm uppercase">
                <th class="px-4 py-3">First name</th>
                <th class="px-4 py-3">Last name</th>
                <th class="px-4 py-3">Assigned tasks</th>
            </tr>
            </thead>
            <tbody>
            {% for worker in workers %}
                <tr class="border-t hover:bg-gray-100">
                    <td class="px-4 py-3">{{ worker.first_name }}</td>
                    <td class="px-4 py-3">{{ worker.last_name }}</td>
                    <td class="px-4 py-3">
                        {% if worker.assigned_tasks.all %}
                            {{ worker.assigned_tasks.count }}
                        {% else %}
                            No tasks assigned
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="3" class="text-center py-4">No workers available.</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}
